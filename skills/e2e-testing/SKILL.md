---
name: e2e-testing
description: Playwright 端對端 (E2E) 測試模式。包含頁面物件模型 (POM)、CI/CD 整合、不穩定測試 (Flaky tests) 處理策略及測試產出管理。
---

# E2E Testing (端對端測試)

此技能提供了使用 Playwright 建立穩定、高效且易於維護的 E2E 測試套件的全面模式。當使用 `/e2e` 指令或執行自動化測試時，請遵循以下規範。

## 指令用法：`/e2e`

**用途**：生成、維護並執行端對端測試。
**工作流**：
1.  **分析用戶旅程**：識別關鍵路徑（如：登入 → 搜尋 → 下單）。
2.  **生成 POM 代碼**：使用 Page Object Model 模式封裝頁面元素。
3.  **跨瀏覽器執行**：在 Chromium, Firefox, WebKit 上同步驗證。
4.  **捕捉產出**：在失敗時自動記錄截圖、影片與 Trace 檔案。

## 關鍵業務流程 (Critical Flows)

在開發與測試過程中，請優先確保以下核心流程的穩定性：
- **🔴 極其重要**：錢包連接、市場瀏覽、語義搜尋、下單交易、資金提取。
- **🟡 重要**：市場建立流程、個人資料更新、即時價格更新、圖表渲染、行動裝置響應式佈局。

## 測試產出管理 (Artifacts)

測試執行後應產生以下檔案以供稽核：
- **HTML 報告**：包含時間軸與結果。
- **失敗截圖**：精確定位 UI 報錯瞬間。
- **Trace 檔案**：提供步驟級別的重播（使用 `npx playwright show-trace` 查看）。

## 不穩定測試 (Flaky Tests) 處理

若測試出現偶發性失敗（如 10 次成功 7 次）：
1.  **增加自動等待**：優先使用 Locator 的等待機制，避免硬編碼 `sleep`。
2.  **網路狀態同步**：在斷言前確保 API 回應已加載完成。
3.  **隔離測試**：確保測試間無依賴關係。
4.  **標註機制**：修復前應標註為 `test.fixme()`。

## 最佳實踐 (Best Practices)

- ✅ **使用 data-testid**：避免使用易變動的 CSS Class 作為選取器。
- ✅ **測試行為而非細節**：關注用戶是否能完成任務，而非按鈕的精確像素位置。
- ✅ **環境隔離**：嚴禁在生產環境執行涉及資金交易的測試。

---
*註：E2E 測試應專注於核心業務流程（Happy Path），細碎的 UI 邏輯請交由單元測試處理。*
