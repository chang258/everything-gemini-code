---
name: tdd-workflow
description: 測試驅動開發 (TDD) 工作流。強制執行「先測試、後代碼」原則，內建腳手架工具快速產生開發樣板。
---

# Test-Driven Development (TDD) 工作流

此技能確保所有的功能開發均遵循 TDD 原則，內建自動化工具加速開發起步。當使用 `/tdd` 指令或啟用此技能時，請遵循以下規範。

## TDD 核心循環 (The Cycle)

```
紅色 (RED) → 綠色 (GREEN) → 重構 (REFACTOR) → 重複 (REPEAT)

RED:      撰寫一個會失敗的測試。
GREEN:    撰寫最小化的代碼讓測試通過。
REFACTOR: 在測試保護下優化代碼，保持測試為綠色。
REPEAT:   進入下一個功能或場景。
```

## 快速腳手架 (Scaffolding Tool)
技能內建了 `new-feature.ps1`，能一鍵產生符合 TDD 規範的原始碼與測試樣板。

### 執行方式
```powershell
powershell -File "$HOME\.gemini\skills\everything-gemini-code\skills\tdd-workflow\scripts\new-feature.ps1" -Name "您的功能名稱"
```

## 詳細操作步驟

1.  **定義介面 (Scaffold)**：先定義類型、介面或函數簽章，但不實作邏輯。
2.  **撰寫失敗測試 (RED)**：針對需求撰寫測試案例（包含正常路徑與邊界情況）。
3.  **執行測試並確認失敗**：驗證測試是否因為「尚未實作」而失敗，而非其他環境因素。
4.  **實作最小代碼 (GREEN)**：僅撰寫足以讓測試通過的最簡潔代碼。
5.  **執行測試並確認通過**：驗證實作符合預期。
6.  **代碼重構 (REFACTOR)**：優化命名、消除重複、提升效能，並確保測試依然通過。
7.  **檢查覆蓋率**：確保測試覆蓋率符合標準。

## 測試覆蓋率要求

*   **最低標準：80%**。
*   **必須 100% 覆蓋的區域**：
    *   財務計算邏輯。
    *   身份驗證與授權 (Auth)。
    *   安全性關鍵代碼。
    *   核心業務流程。

## 最佳實踐 (Best Practices)

*   ✅ **先寫測試，後寫代碼**：嚴禁在沒有測試的情況下撰寫功能。
*   ✅ **最小實作**：不要寫「以後可能會用到」的代碼。
*   ✅ **測試行為而非細節**：測試應關注輸出結果與行為，而非內部實作路徑。
*   ✅ **包含邊界情況**：空值、Null、極大/極小值及錯誤情境都應有測試。
*   ❌ **不要過度模擬 (Over-mocking)**：優先使用整合測試，除非外部依賴難以控制。

---
*註：測試不只是檢查錯誤，更是代碼行為的正式規格說明。*
