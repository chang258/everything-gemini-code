# 代碼風格與品質規範 (Coding Style)

## 不變性原則 (Immutability - CRITICAL)

**優先**建立新物件，而非修改現有物件：

```typescript
// 錯誤：直接修改原始物件
original.field = value;

// 正確：返回具備變動的新副本 (Spread Operator)
const updated = { ...original, field: value };
```

**理由**：不變性數據能防止隱藏的副作用，使調試更容易，並確保執行緒安全。

## 檔案組織規範

**多個小檔案 > 少數大檔案**：
- **高內聚、低耦合**：每個模組只做一件事。
- **檔案長度**：典型長度 200-400 行，**最高上限 800 行**。
- **模組化**：從大型模組中提取工具函數 (Utilities)。
- **組織方式**：依據功能/領域 (Domain) 組織，而非依據檔案類型 (Type)。

## 錯誤處理

**全面處理錯誤**：
- 在每一層級明確處理錯誤，避免沉默失效。
- 對於 UI 面向的代碼，提供友善的使用者錯誤訊息。
- 在服務端詳細記錄錯誤上下文 (Logging)。
- 嚴禁靜默吞掉錯誤 (`except: pass` 或空 `catch`)。

## 輸入驗證與邊界檢查

**系統邊界強制驗證**：
- 在處理前驗證所有使用者輸入。
- 使用基於 Schema 的驗證工具（如 Zod, Pydantic）。
- 儘早失敗 (Fail Fast) 並提供清晰的錯誤訊息。
- 不信任任何外部數據（API 回應、用戶輸入、檔案內容）。

## 品質檢核清單 (品質門檻)

在標記任務完成前，必須勾選：
- [ ] 代碼具備高度可讀性且命名精確。
- [ ] 函數長度不超過 50 行。
- [ ] 檔案長度不超過 800 行（建議 400 內）。
- [ ] 巢狀結構不超過 4 層。
- [ ] 具備完善的錯誤處理與日誌稽核。
- [ ] 絕無硬編碼數值（使用常量或配置）。
- [ ] 嚴格遵循不變性原則（使用 Spread 等模式）。
- [ ] **KISS/DRY 原則**：代碼簡單易懂且無不必要的重複。

---
*註：好的代碼本身就是最好的文檔。*
